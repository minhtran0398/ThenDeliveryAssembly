@page "/order-of-merchant/{MerchantId:int}"
@inherits MerchantOrderListBase

@if (ResponseModel != null)
{
   <DxPopup HeaderText="Thông tin" @bind-Visible="@ResponseModel.IsShowPopup"
            HeaderCssClass="bg-dark text-white p-2"
            FooterCssClass="p-2 modal-footer">
      <Content>
         <p>@ResponseModel.Message</p>
      </Content>
      <FooterTemplate>
         <button class="btn btn-sm btn-dark" @onclick="() => ResponseModel.IsShowPopup = false">
            Đóng
         </button>
      </FooterTemplate>
   </DxPopup>
}

<DxPopup HeaderText="Thông tin" @bind-Visible="@IsShowPopupConfirm"
         HeaderCssClass="bg-dark text-white p-2"
         FooterCssClass="p-2 modal-footer">
   <Content>
      <p>@PopupConfirmMessage</p>
   </Content>
   <FooterTemplate>
      <button class="btn btn-sm btn-primary" @onclick="async () => await ConfirmAction()">
         Xác nhận
      </button>
      <button class="btn btn-sm btn-dark" @onclick="() => IsShowPopupConfirm = false">
         Đóng
      </button>
   </FooterTemplate>
</DxPopup>

@if (OrderList is null)
{
   <p>Đang tải...</p>
}
else if(OrderList.Count == 0)
{
   <p>Chưa có đơn hàng cho quán này</p>
}
else
{
   @* <div class="list-group">
      @foreach (var orderItem in OrderList.OrderBy(e => e.Status)
                                       .ThenByDescending(e => e.DeliveryDateTime)
                                       .ThenByDescending(e => e.OrderDateTime))
      {
         <a href="javascript:void(0)"
            class="list-group-item list-group-item-action
                  @(GetColorCssOrderStatus(orderItem.Status))">
            <div class="d-flex w-100 justify-content-between">
               <h5 class="mb-1 font-weight-bold">@orderItem.User.UserName - @orderItem.User.PhoneNumber</h5>
               <small>@TimeRange.GetDurationStringToNow(orderItem.OrderDateTime)</small>
            </div>
            <div class="d-flex w-100 justify-content-between pb-2">
               <h6 class="mb-1 font-small">Thời gian giao: @orderItem.DeliveryDateTime.ToString("HH:mm dd/MM/yyyy")</h6>
            </div>
            @foreach (var order in orderItem.OrderItemList)
            {
               <div class="pb-2 w-100">
                  <div class="d-flex w-100 justify-content-between">
                     <p class="mb-0" style="font-weight:700;text-decoration:underline">
                        @order.OrderProductToppingName
                     </p>
                     <span class="badge badge-success badge-pill" style="line-height:1.5">@order.Quantity phần</span>
                  </div>
                  @if (!string.IsNullOrWhiteSpace(order.Note))
                  {
                     <p class="mb-0 font-small font-italic">Ghi chú: @order.Note</p>
                  }
               </div>
            }
         </a>
      }
   </div> *@

   <table class="table font-small table-bordered">
      <thead class="thead-dark">
         <tr>
            <th scope="col">STT</th>
            <th scope="col">Thời gian</th>
            <th scope="col">Chi tiết</th>
            <th scope="col">Tổng tiền</th>
            <th scope="col">Trạng thái</th>
            <th scope="col"></th>
         </tr>
      </thead>
      <tbody>
         @foreach (var order in OrderList.OrderByDescending(e => e.OrderDateTime))
         {
            <tr>
               <th scope="row">@(++Count)</th>
               <td>
                  Thời gian đặt: @order.OrderDateTime.ToString("HH:mm dd/MM/yyyy") <br />
                  Thời gian giao hàng: @order.DeliveryDateTime.ToString("HH:mm dd/MM/yyyy")
               </td>
               <td>
                  @foreach (var orderItem in order.OrderItemList)
                  {
                     <div class="pb-2 w-100">
                        <div class="d-flex w-100 justify-content-between">
                           <p class="mb-0" style="font-weight:700;text-decoration:underline">
                              @orderItem.OrderProductToppingName
                           </p>
                           <span class="badge badge-success badge-pill" style="line-height:1.5">@orderItem.Quantity phần</span>
                        </div>
                        @if (!string.IsNullOrWhiteSpace(orderItem.Note))
                        {
                           <p class="mb-0 font-small font-italic">Ghi chú: @orderItem.Note</p>
                        }
                     </div>
                  }
               </td>
               <td>
                  Thành tiền: @(order.TotalAmount.ToString("N0"))đ <br />
                  Tổng cộng @(order.OrderItemList.Count) món
               </td>
               <td><span class="@(order.Status.GetCssClass())">@(order.Status.GetStringValue())</span></td>
               <td>
                  @if (order.Status == OrderStatus.OrderSuccess)
                  {
                        <DxButton Text="Xác nhận"
                                  RenderStyle="ButtonRenderStyle.Primary"
                                  SizeMode="SizeMode.Small"
                                  @onclick="() => HandleConfirmOrder(order)" />
                        <DxButton Text="Hủy đơn"
                                  RenderStyle="ButtonRenderStyle.Danger"
                                  SizeMode="SizeMode.Small"
                                  @onclick="() => HandleCancelOrder(order)" />
                  }
               </td>
            </tr>
         }
      </tbody>
   </table>
}

